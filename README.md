# Meter-reading-recognition

Проект по распознаванию показаний на электрических счетчиках: на вход подается циферблат с показаниями (без самого счетчика, только показания), а на выходе получаем показания в виде числа.
В проекте используется админка Django для реализации UI, чтобы работать с данными, и Keras для обучения нейронной сети.
## Оглавление
1) [Установка](README.md#установка)
2) [Запуск на GPU](README.md#запуск-на-gpu)

## Установка
[Ссылка на документациюъ](./docs/ru/index.md#установка)


## Запуск на GPU

Чтобы запустить нейросеть на GPU, необходимо выполнить следующие шаги:

1) Создать контейнер в Docker, используя следующую команду:
```bash
docker run -it --gpus all -v absolute_path/src:/app/ --name container_name tensorflow/tensorflow:latest-gpu
```

2) Войти в контейнер:
```bash
docker exec -it container_name bash
```

3) Перейти в директорию `app`:
```bash
cd app
```

4) Установить все необходимые пакеты с помощью pip:
```bash
pip install package_name
```

5) Запустить обучение или выполнение нейронной сети. Она будет выполнена на GPU.


## Работа с данными

### Модели

- **Training** — содержит данные для обучения и проверки нейронной сети.  
- **TrainingElement** — содержит фрагменты изображений для генерации обучающих данных.  
- **TrainingAugmentation** — содержит сгенерированные изображения из фрагментов, используемых в **TrainingElement**.
- **NeuralModel** — при обучении нейросети создаётся эта модель, которая сохраняет её структуру.
- **NeuralVersion** — имеет внешнюю ссылку на **NeuralModel** и создаётся при дообучении. Хранит в себе статистику по выборкам валидации и изменения, которые были внесены при дообучении.

### Команды

Для запуска команды в консоли введите:  
`python manage.py название_команды`

- `create_base_data` — эта команда выгрузит тестовую и валидационную выборку модели `Training` и все объекты `TrainingElement` в папку `base_dataset` в приложении `data`.
- `import_base_data` — эта команда загрузит тестовую и валидационную выборку в модели `Training` и `TrainingElement` из папки `base_dataset` в приложении `data`.
- `import_training_data` — эта команда загружает данные в модель `Training`. Для работы команды выполните следующие шаги:
  1. **Создание файла**: Сначала создайте файл `training.csv` в директории `apps/data/import_training`. В этом файле должны быть следующие поля:
     - `image` (тип `str`): содержит только название изображения.
     - `type` (тип `int`): значения соответствуют enum-списку `TrainingType`.
     - `correct_value` (тип `str`): содержит число, которое находится на изображении.
  2. **Загрузка изображений**: Загрузите связанные изображения в папку `apps/data/import_training/images`.
- `generate_images` — эта команда берет случайные изображения из модели `TrainingElement` и создает из них объект `TrainingAugmentation`.
  1. **Обязательные аргументы**:
     - `training_element_type` (тип `int`): число, которое берется из enum списка `TrainingElementType` и показывает, какого типа `TrainingElement` будут выбраны и какого типа `TrainingAugmentation` будут сгенерированы.
     - `number_images` (тип `int`): количество сгенерированных изображений.
       * Поскольку генерация изображений происходит случайным образом без дубликатов, `number_images` ограничено, так как найти все комбинации может быть слишком долго. Например, если есть по 20 вариантов `TrainingElement` с типами `start`, `middle` и `end`, то можно сгенерировать (20 * 20 * 20 = 8000) новых изображений.
- `training_duplicate_removal` — удаляет все дубликаты в модели `Training`.
- `neural_training` — команда для начала обучения нейронной сети. Она собирает данные из моделей `Training` и `TrainingAugmentation` и запускает обучение. После завершения создаёт экземпляр модели `NeuralModel` и 1-ю версию `NeuralVersion`.
  1. **Обязательные аргументы**:
     - `model_name` (тип `str`): название модели которое будет записанно в `NeuralModel`.
     - `epochs` (тип `int`): количество эпох обучения.
- `neural_pre_training` — команда дообучает существуюшую модель и создает новую версию. Она собирает данные из моделей `Training` и `TrainingAugmentation` и запускает дообучение. После завершения создаёт экземпляр модели `NeuralModel` и новую версию `NeuralVersion`.
  1. **Обязательные аргументы**:
     - `model_name` (тип `str`): название модели которое будет записанно в `NeuralModel`.
     - `epochs` (тип `int`): количество эпох обучения.
     - `changes` (тип `str`): изменения которе были внесены.

## Архитектура модели

### Формат вывода нейронной сети

Формат вывода нейронной сети представлен в виде двумерного массива размером 11x10, где индекс `column[0]` обозначает позицию десятичной точки с конца, а индексы `column[1-10]` обозначают цифры числа. Функция `convert_float_to_categorical` преобразует число в его категориальное представление.

#### Пример:

Для числа 2.29 результат будет таким:
```python
[
    [0, 0, 1, 0, 0, 0, 0, 0, 0, 0],  # десятичная точка на 2-й позиции с конца
    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0],  # соответствует цифре 0
    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0],  # соответствует цифре 0
    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0],  # соответствует цифре 0
    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0],  # соответствует цифре 0
    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0],  # соответствует цифре 0
    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0],  # соответствует цифре 0
    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0],  # соответствует цифре 0
    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0],  # соответствует цифре 0
    [0, 0, 1, 0, 0, 0, 0, 0, 0, 0],  # соответствует цифре 2
    [0, 0, 1, 0, 0, 0, 0, 0, 0, 0],  # соответствует цифре 2
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 1]   # соответствует цифре 9
]

